<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe — Clean UI</title>
  <style>
    :root {
      --bg1: #0f1226;
      --bg2: #1a2340;
      --card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.12);
      --text: #f7f8ff;
      --muted: #b8c0ff;
      --accent: #7c9cff;
      --accent-2: #00e6a8;
      --win: #37d67a;
      --lose: #ff6b6b;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1000px 600px at 20% 10%, #263066 0%, transparent 60%),
                  radial-gradient(900px 600px at 80% 90%, #223158 0%, transparent 60%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card {
      width: min(92vw, 780px);
      background: var(--card);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35), inset 0 0 0 1px rgba(255,255,255,0.04);
      overflow: hidden;
      animation: lift-in 400ms ease both;
    }
    @keyframes lift-in { from { transform: translateY(8px); opacity: 0 } }

    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 20px; border-bottom: 1px solid var(--border);
    }
    .title { font-size: 22px; font-weight: 700; letter-spacing: .2px; }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; }
    select, button {
      appearance: none;
      padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border);
      background: rgba(255,255,255,0.04); color: var(--text);
      font-weight: 600; letter-spacing: .2px;
    }
    button { cursor: pointer; transition: transform .06s ease; }
    button:active { transform: translateY(1px) scale(0.99); }

    .wrap {
      display: grid; gap: 18px; padding: 20px; grid-template-columns: 1fr; align-items: start;
    }

    .scorebar {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
    }
    .chip {
      border: 1px solid var(--border); background: rgba(255,255,255,0.04);
      border-radius: 14px; padding: 10px 12px; display: flex; align-items: center; gap: 8px;
      font-weight: 700; letter-spacing: .3px; justify-content: center;
    }
    .dot { width: 8px; height: 8px; border-radius: 999px; background: var(--muted); box-shadow: 0 0 10px currentColor; }
    .dot.x { background: var(--accent); }
    .dot.o { background: #ff9bd2; }
    .dot.d { background: var(--accent-2); }

    .board {
      width: min(92vw, 520px);
      margin: 0 auto;
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
    }
    .cell {
      aspect-ratio: 1 / 1;
      display: grid; place-items: center;
      font-size: clamp(38px, 12vw, 64px);
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      border-radius: 16px;
      user-select: none; cursor: pointer; position: relative; overflow: hidden;
      transition: border-color .2s ease, background .2s ease, transform .08s ease;
    }
    .cell:hover { border-color: rgba(255,255,255,0.35); }
    .cell.taken { cursor: not-allowed; }
    .mark { transform: scale(0.8); filter: drop-shadow(0 4px 18px rgba(0,0,0,.2)); animation: pop .18s ease-out both; }
    @keyframes pop { from { transform: scale(0.6); opacity: 0 } }
    .winner { box-shadow: 0 0 0 2px var(--win) inset, 0 0 24px rgba(55,214,122,.45); background: rgba(55,214,122,.15) !important; }

    .status {
      text-align: center; font-weight: 700; letter-spacing: .3px; color: var(--muted);
    }
    .status strong { color: var(--text) }

    .footer { display: flex; gap: 10px; justify-content: center; padding-bottom: 6px; }

    @media (min-width: 880px) {
      .wrap { grid-template-columns: 1fr 1fr; }
      .board { width: 100%; }
    }
  </style>
</head>
<body>
  <main class="card" role="application" aria-label="Tic Tac Toe">
    <div class="header">
      <div class="title">Tic Tac Toe</div>
      <div class="controls">
        <select id="mode" aria-label="Game mode">
          <option value="pvp">Player vs Player</option>
          <option value="cpu-easy">Player vs Computer — Easy</option>
          <option value="cpu-hard">Player vs Computer — Hard</option>
        </select>
        <button id="restartBtn" aria-label="Restart round">Restart</button>
        <button id="resetScoreBtn" aria-label="Reset scoreboard">Reset scores</button>
      </div>
    </div>

    <div class="wrap">
      <section>
        <div class="scorebar" aria-label="Scoreboard">
          <div class="chip"><span class="dot x"></span> X Wins: <span id="xScore">0</span></div>
          <div class="chip"><span class="dot o"></span> O Wins: <span id="oScore">0</span></div>
          <div class="chip"><span class="dot d"></span> Draws: <span id="draws">0</span></div>
        </div>
        <p class="status" id="status">Turn: <strong>X</strong></p>
      </section>

      <section>
        <div class="board" id="board" role="grid" aria-label="Game board"></div>
        <div class="footer" style="padding-top:14px">
          <!-- reserved for future extras -->
        </div>
      </section>
    </div>
  </main>

  <script>
    // ======= State =======
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const xScoreEl = document.getElementById('xScore');
    const oScoreEl = document.getElementById('oScore');
    const drawsEl  = document.getElementById('draws');
    const modeEl   = document.getElementById('mode');
    const restartBtn = document.getElementById('restartBtn');
    const resetScoreBtn = document.getElementById('resetScoreBtn');

    const winningCombos = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    let currentPlayer = 'X';
    let cells = Array(9).fill(null);
    let gameActive = true;
    let scores = { X: 0, O: 0, D: 0 };

    // Persist scoreboard & mode
    (function loadPersisted(){
      try{
        const saved = JSON.parse(localStorage.getItem('ttt-scores'));
        if(saved) scores = saved;
        const savedMode = localStorage.getItem('ttt-mode');
        if(savedMode) modeEl.value = savedMode;
      }catch(e){}
      updateScores();
    })();

    // ======= Audio (WebAudio = no external files) =======
    let audioCtx;
    function beep(freq=500, duration=90, type='sine', gain=0.04){
      try{
        audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type; o.frequency.value = freq;
        g.gain.value = gain; o.connect(g); g.connect(audioCtx.destination);
        o.start(); setTimeout(()=>{ o.stop(); }, duration);
      }catch(e){}
    }
    function clickFx(){ beep(620, 70, 'triangle', 0.05); }
    function winFx(){ beep(520, 120, 'sawtooth', 0.05); setTimeout(()=>beep(720, 120, 'sawtooth', 0.05), 120); }
    function drawFx(){ beep(380, 160, 'square', 0.04); }

    // ======= UI Setup =======
    function makeCell(i){
      const btn = document.createElement('button');
      btn.className = 'cell';
      btn.setAttribute('role','gridcell');
      btn.setAttribute('aria-label', 'Cell ' + (i+1));
      btn.dataset.index = i;
      btn.addEventListener('click', onCellClick);
      return btn;
    }

    function buildBoard(){
      boardEl.innerHTML = '';
      for(let i=0;i<9;i++) boardEl.appendChild(makeCell(i));
      cells = Array(9).fill(null);
      currentPlayer = 'X';
      gameActive = true;
      setStatusTurn();
    }

    function setStatusTurn(){ statusEl.innerHTML = `Turn: <strong>${currentPlayer}</strong>`; }

    function renderMark(target, mark){
      const span = document.createElement('span');
      span.className = 'mark';
      span.textContent = mark;
      target.appendChild(span);
      target.classList.add('taken');
    }

    // ======= Game Mechanics =======
    function onCellClick(e){
      const idx = +e.currentTarget.dataset.index;
      if(!gameActive || cells[idx]) return;
      moveAt(idx, currentPlayer);
      clickFx();
      const result = evaluate();
      if(result) return endRound(result);
      toggleTurn();
      maybeCpuMove();
    }

    function moveAt(idx, mark){
      cells[idx] = mark;
      renderMark(boardEl.children[idx], mark);
    }

    function evaluate(){
      for(const combo of winningCombos){
        const [a,b,c] = combo;
        if(cells[a] && cells[a]===cells[b] && cells[a]===cells[c]){
          combo.forEach(i=> boardEl.children[i].classList.add('winner'));
          return cells[a]; // 'X' or 'O'
        }
      }
      if(cells.every(Boolean)) return 'D'; // draw
      return null; // ongoing
    }

    function endRound(result){
      gameActive = false;
      if(result==='D'){
        statusEl.innerHTML = `Result: <strong>Draw</strong>`;
        scores.D++; updateScores(); drawFx();
      } else {
        statusEl.innerHTML = `Winner: <strong>${result}</strong>`;
        scores[result]++; updateScores(); winFx();
      }
    }

    function toggleTurn(){ currentPlayer = currentPlayer==='X' ? 'O' : 'X'; setStatusTurn(); }

    function updateScores(){
      xScoreEl.textContent = scores.X;
      oScoreEl.textContent = scores.O;
      drawsEl.textContent  = scores.D;
      try{ localStorage.setItem('ttt-scores', JSON.stringify(scores)); }catch(e){}
    }

    // ======= CPU Player =======
    function maybeCpuMove(){
      const mode = modeEl.value;
      if(!gameActive) return;
      if(mode.startsWith('cpu') && currentPlayer==='O'){
        setTimeout(()=>{
          const idx = (mode==='cpu-easy') ? pickEasyMove() : pickBestMove('O');
          moveAt(idx, 'O');
          clickFx();
          const res = evaluate();
          if(res) return endRound(res);
          toggleTurn();
        }, 180);
      }
    }

    function pickEasyMove(){
      // try center, then corners, else any
      const preferred = [4,0,2,6,8,1,3,5,7];
      return preferred.find(i=>!cells[i]);
    }

    function pickBestMove(ai){
      const hu = (ai==='X') ? 'O' : 'X';
      // Minimax with pruning for 3x3 (fast)
      function minimax(isMax){
        const winner = checkWinnerFast();
        if(winner===ai) return {score: 10};
        if(winner===hu) return {score: -10};
        if(cells.every(Boolean)) return {score: 0};
        let best = {score: isMax? -Infinity : Infinity, idx: -1};
        for(let i=0;i<9;i++) if(!cells[i]){
          cells[i] = isMax ? ai : hu;
          const val = minimax(!isMax).score;
          cells[i] = null;
          if(isMax){ if(val>best.score){ best = {score: val, idx: i}; } }
          else { if(val<best.score){ best = {score: val, idx: i}; } }
        }
        return best;
      }
      function checkWinnerFast(){
        for(const [a,b,c] of winningCombos){ if(cells[a]&&cells[a]===cells[b]&&cells[a]===cells[c]) return cells[a]; }
        return null;
      }
      return minimax(true).idx ?? pickEasyMove();
    }

    // ======= Events =======
    restartBtn.addEventListener('click', buildBoard);
    resetScoreBtn.addEventListener('click', ()=>{ scores={X:0,O:0,D:0}; updateScores(); buildBoard(); });
    modeEl.addEventListener('change', e=>{ localStorage.setItem('ttt-mode', e.target.value); buildBoard(); });

    // Init
    buildBoard();
  </script>
</body>
</html>
